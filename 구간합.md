# 구간합이란?

주어진 숫자 배열을 통해 합배열을 만들어서 시간복잡도를 크게 줄이는 알고리즘

## 구간합의 핵심이론

구간합은 숫자배열을 가지고 합배열을 구해야 한다.

그렇게 구한 합 배열을 통해 다음의 합산 값을 미리 구할 수 도 있고

구간합을 구할 수 있다.

숫자배열을 A[N]이라 하고 합배열을 S[N]이라 하면
```
S[i] = A[0] + A[1] + A[2] + ... + A[i-1] + A[i];
```
인데, 여기서 구간 i~j의 합 result를 구하려고 하면
```
result = S[j] - S[i-1]
```
이 된다.

따라서 합 배열을 미리 구해놓으면 시간복잡도가 N에서 1이된다.

그 이유는

예를들어 크기 N인 숫자배열 A[N]가 있고 구간이 i와 j로 주어졌을 때

합배열없이 구간합을 구하려고 하는데

최악의 경우를 생각해보면 i=0 이고 j가 N인 경우이므로 시간복잡도는 N이된다.

하지만 S[i] = S[i-1]+A[i] 식을 통해 합배열을 미리 구하면 아래와 같다.

|인덱스|0|1|2|3|4|5|
|---|---|---|---|---|---|---|
|배열A|15|13|10|7|3|12| 
|합배열S|15|28|38|45|48|60|

구간합을 구하면 아무리 최악의 경우라도 단순 빼기를 통해 연산하면 구간합을 구할 수 있어진다.

### 2차원 배열에서의 구간합

항상 주어진 크기에 +1 한 2차원 누적합 배열 S를 만들어야하며

누적합 2차원 배열을 만들때 중요 한 점은 공통인 부분을 뻬주어야 한다.

예를들어 다음과 같은 2차원 배열이 주어진다면 
```
1 2 4
8 16 32
```
여기서의 누적합 배열을 구하는 방법은

그림으로 먼저 설명하자면

![2차원 누적합](https://github.com/kimhaechang1/coding-test/assets/81299056/75473838-7b6d-4539-a82d-32ad1da11e46)

저렇게 검은색 네모칸까지의 합들에서 공통부분인 노란색 부분을 빼주고 원래 배열에서의 노란 동그라미부분을 더하면 

해당 칸 까지의 누적합을 구할 수 있다.

이를 식으로 나타내면

원래배열을 map, 2차원 누적합 배열을 S로 두었을 때 (원래배열의 크기는 2,3 이지만 누적합 배열은 누적합을 원할하게 구하기 위해 하나씩 더 크게 만든다)

S[1][1] = S[0][1] + S[1][0] + map[0][0] - S[0][0] 이라는 식이 형성된다.

이렇게 하여 겉부분들을 모두 구하면 

S[2][1] = S[1][1] + S[2][0] + map[1][0] - S[1][0]

S[1][2] = S[1][1] + S[0][2] + map[0][1] - S[0][1]

...

이런식으로 구하게 될 것이고

코드로 나타내면 다음과 같다.

```java
for(int i = 1;i<=N;i++){
  for(int j= 1;j<=M;j++){
    S[i][j] = S[i-1][j]+S[i][j-1]+map[i-1][j-1]-S[i-1][j-1];
  }
}
```
여기서 구하는 쿼리에 맞는 구간합을 구한다고 하면

똑같이 최대로 구해지는 크기에서 원하는 부위만이 남도록 짜르고 공통으로 짤린부분을 한번 더하면 된다.

그림으로 표현하자면

예를들어 (1,1) (2,3) 까지의 합을 구한다고 한다면 

(여기서 주어진 각 좌표들은 1부터 시작하기에 실제 원래 2차원 배열에서는 각 -1씩을 뜻한다.)

![2차원 누적합2](https://github.com/kimhaechang1/coding-test/assets/81299056/9efb963f-d6d1-4a60-b884-9c5dacdb97fb)

해당 그림에서 초록색 네모가 필요한 누적합의 크기이다. 

(어쩔수 없이 누적합 배열에서 표기했지만, 실제 배열에서도 저만큼이 딱 잡힌다고 생각하면된다. )

저만큼을 구하기 위해 젤 크게 잡을 수 있는 크기인 파란색 영역에서 = S[2][3]

갈색 영역들을 빼주고 = S[0][3] + S[2][0]

공통적으로 빠진 노란색 영역을 다시 더해준다. = S[0][0]

결국 식으로 표현하면 

S[2][3] - S[0][3] - S[2][0] + S[0][0] 을 구하면 된다.

결국 첫 좌표를 y1, x1 그리고 후 좌표를 y2, x2 라고 주어졌을 때, 두 좌표 사이 영역의 누적합은

S[y2][x2] - S[y1-1][x2]-S[y2][x1-1] + S[y1-1][x1-1]이 된다.

이렇게 구하면 2차원배열의 부분합도 O(1)의 시간복잡도로 구할 수 있게 된다.
